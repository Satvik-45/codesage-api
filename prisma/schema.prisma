generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
model Repository {
  id         String     @id @default(uuid())
  name       String
  sourceType String     // "ZIP" or "GITHUB"
  githubUrl  String?
  createdAt  DateTime   @default(now())
  files      File[]
  questions  Question[]
}
model File {
  id            String     @id @default(uuid())
  repositoryId  String
  filePath      String
  language      String?
  size          Int?
  createdAt     DateTime   @default(now())
  repository    Repository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  chunks        FileChunk[]
}
model FileChunk {
  id        String   @id @default(uuid())
  fileId    String
  startLine Int
  endLine   Int
  content   String
  embedding Unsupported("vector(384)")?
  createdAt DateTime @default(now())
  file      File     @relation(fields: [fileId], references: [id], onDelete: Cascade)
  references Reference[]
}
model Question {
  id           String     @id @default(uuid())
  repositoryId String
  questionText String
  answerText   String
  createdAt    DateTime   @default(now())
  repository   Repository @relation(fields: [repositoryId], references: [id], onDelete: Cascade)
  references   Reference[]
}
model Reference {
  id          String    @id @default(uuid())
  questionId  String
  fileChunkId String
  question    Question  @relation(fields: [questionId], references: [id], onDelete: Cascade)
  fileChunk   FileChunk @relation(fields: [fileChunkId], references: [id], onDelete: Cascade)
}
